{% extends "base.jinja" %}

{% block title %}Cipher Information{% endblock %}

{% block content %}
    <h1>Cipher Information</h1>
    <form enctype="multipart/form-data" method="POST">
        <label for="cipher">Cipher:</label>
        <input value="{{ cipher }}" type="text" id="cipher" name="cipher">
        <input type="file" name="cipher_file" id="cipher_file">
        <br><br>
        <label for="key_length">Key Length (optional):</label>
        <input value="{{ key_length }}" type="number" id="key_length" name="key_length" min="2" max="40">
        <br><br>
        <input type="submit" value="Get info">
    </form>
    {% if most_likely_key_sizes %}
        <table>
            <tr>
                <th>key size</th>
                <th>Score</th>
            </tr>
            {% for key_size in most_likely_key_sizes %}
                <tr>
                    <td>{{ key_size[0] }}</td>
                    <td>{{ key_size[1] }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    {% if patterns %}
        <table>
            <tr>
                <th>pattern</th>
                <th>spacing</th>
                <th>occurrences</th>
            </tr>
            {% for pattern in patterns %}
                <tr>
                    <td>{{ pattern.pattern }}</td>
                    <td>{{ pattern.spacing }}</td>
                    <td>{{ pattern.occurrences }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    {% if letter_distribution %}
        <h2>Letter Distribution</h2>
        <table>
            <tr>
                <th>Letter</th>
                <th>Percentage</th>
            </tr>
            {% for letter, percentage in letter_distribution %}
                <tr>
                    <td>{{ letter }}</td>
                    <td>{{ "%.2f"|format(percentage) }}%</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    {% if bucket_distributions %}
        <h2>Letter Distributions by Key Position</h2>
        <p>Key Length: {{ key_length }}</p>
        <div style="display: flex; flex-wrap: wrap; gap: 20px;">
            {% for distribution in bucket_distributions %}
                <div style="flex: 1; min-width: 200px;">
                    <h4>Position {{ loop.index }}</h4>
                    <table style="font-size: 0.9em;">
                        <tr>
                            <th>Letter</th>
                            <th>%</th>
                            <th>Key?</th>
                        </tr>
                        {% for letter in 'abcdefghijklmnopqrstuvwxyz' %}
                            {% if distribution[letter] > 0 %}
                                <tr>
                                    <td>{{ letter }}</td>
                                    <td>{{ "%.1f"|format(distribution[letter]) }}%</td>
                                    <td>
                                        {% if 17 <= distribution[letter] <= 19 %}
                                            {% set letter_index = 'abcdefghijklmnopqrstuvwxyz'.index(letter) %}
                                            {% set e_index = 4 %}
                                            {% set key_index = (letter_index - e_index) % 26 %}
                                            <strong>{{ 'abcdefghijklmnopqrstuvwxyz'[key_index] }}</strong>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </table>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}
